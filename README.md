# Bash-Commands
## Запуск
### Локально
```shell
make run
CTRL + C // для остановки сервера 
``` 
Сервер поднимется на ```lovalhost:8080```. Адрес сервера можно изменить в ```env``` файлах (о них ниже).
### Запуск в docker
```shell
make docker_build
make docker_up // docker compose up
make docker_down // docker compose down -- остановка контейнера
```
Возможно, для выполнения этих команд потребуются права суперюзера (```sudo```). При запуске в контейнере база данных
будет храниться в папке ```data```. Для доступа к данным в ```data``` необходимо использовать права суперпользователя или
сменить ей владельца, например, с помощью ```chown```, так как владельцем этой папки изначально будет являться рутпользователь.



## Описание работы
Использована база данных Postgres, стандартный пакет. В целом в проекте использовано минимальное количество
сторонних пакетов (только один - для парсинга переменных окружения). Для подключения к базе данных используюся переменные окружения, определенные в файлах ```env/.env``` и ```env/.env_docker```.
В файлах ```.env (.env_docker)``` можно изменить логин/пароль пользователя базы данных.
Путь к этим файлам фиксирован.

Логи записываются по умолчанию в ```logs/log.txt```, путь до логгера можно изменить в ```.env (.env_docker)```. Формат логов:
```
time=2024-05-14T20:55:26.283+03:00 level=ERROR msg="failed to exec command" op=handlers.url.run_command.NewRunner request_id="" error="signal: interrupt"
```



### Организация базы данных
В базе данных 2 таблицы:
``` SQL
                                        Table "public.commands"
 Column  |  Type   | Collation | Nullable |               Default                
---------+---------+-----------+----------+--------------------------------------
 id      | integer |           | not null | nextval('commands_id_seq'::regclass)
 command | text    |           | not null | 


```

``` SQL
                                        Table "public.outputs"
   Column   |            Type             | Collation | Nullable |               Default               
------------+-----------------------------+-----------+----------+-------------------------------------
 id         | integer                     |           | not null | nextval('outputs_id_seq'::regclass)
 command_id | integer                     |           |          | 
 pid        | integer                     |           |          | 
 output     | text                        |           |          | 
 created_at | timestamp without time zone |           | not null | now()

```
```commands``` хранит id команд и сами команды. В таблице ```outputs``` хранятся выводы команд с их ```pid```. 
Можно, например, добавить метод для получения истории всех запусков одной команды.


## Что реализовано
Реализованы все обязательные требования. 
### Дополнительные задания
* Реализован метод получения одной команды
* Реализован метод остановки команды. При запуске команды пользователь сразу получает ее PID, поэтому может
 остановить выполнение до завершения команды
* Статический анализ кода ```make check```